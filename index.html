<!DOCTYPE html>
<!--
  Quiddler Scoring App
  - UI: Tailwind-based form for players, rounds, and a tools drawer (Dictionary + Solver)
  - Scripts load order:
      1) Data: collins_dictionary.js, card_scores.js, common_lemmas.js
      2) ESM: wink-lemmatizer (needed by Solver common-word filter)
      3) App: dictionary_api.js, scoring.js, render.js, optimizer.js, game.js, tools_drawer.js
  - Entry points used by the page: startGame(), nextRound(), initToolsDrawer()
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiddler Scoring App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tippy.js Tooltip Dependencies -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css"/>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6">
        <h1 class="text-2xl font-bold mb-4">Quiddler Scoring App</h1>

        <div class="mb-4">
            <label class="block font-semibold">Player Names (comma separated):</label>
            <input id="playersInput" class="w-full p-2 border rounded mt-2" placeholder="e.g., Alice,Bob,Charlie">
            <div class="mt-2 space-y-2">
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="longestWordBonus">
                    <label for="longestWordBonus">Longest Word Bonus ðŸ¦’</label>
                    <input id="longestWordPoints" type="number" value="10" min="0"
                        class="w-16 border rounded p-1">
                    <span>points</span>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="mostWordsBonus">
                    <label for="mostWordsBonus">Most Words Bonus ðŸ¥’</label>
                    <input id="mostWordsPoints" type="number" value="10" min="0"
                        class="w-16 border rounded p-1">
                    <span>points</span>
                </div>
            </div>
            <button id="gameGo" class="mt-3 bg-blue-500 text-white py-2 px-4 rounded">Start Game</button>
        </div>

        <div id="gameArea" class="hidden">
            <h2 class="font-semibold text-xl mb-2" id="roundHeader"></h2>

            <div id="scoreInputs"></div>

            <button id="submitRoundBtn" class="mt-3 bg-blue-500 text-white py-2 px-4 rounded">Submit Round</button>

            <h3 class="font-semibold text-xl mt-6">Running Totals</h3>
            <ul id="scoreTotals" class="list-disc pl-6"></ul>

            <h3 class="font-semibold text-xl mt-6">Previous Rounds</h3>
            <div id="previousRounds" class="mt-2"></div>
        </div>
    </div>

    <!-- Tools Drawer Toggle Button -->
    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-50">
      <button id="dictToolBtn"
              class="w-14 h-14 rounded-full bg-gray-500 hover:bg-gray-600 flex items-center justify-center shadow-lg"
              aria-label="Open Dictionary"
              data-tippy-content="Dictionary"
              type="button">
        <img src="https://cdn.jsdelivr.net/npm/heroicons@2.1.5/24/outline/book-open.svg"
             class="w-7 h-7 invert" alt="" />
      </button>

      <button id="optToolBtn"
              class="w-14 h-14 rounded-full bg-gray-500 hover:bg-gray-600 flex items-center justify-center shadow-lg"
              aria-label="Open Optimizer"
              data-tippy-content="Solver"
              type="button">
        <img src="https://cdn.jsdelivr.net/npm/heroicons@2.1.5/24/outline/cog-6-tooth.svg"
             class="w-7 h-7 invert" alt="" />
      </button>
    </div>

    <!-- Backdrop -->
    <div id="toolsBackdrop"
         class="fixed inset-0 bg-black/30 z-40 hidden opacity-0 transition-opacity"></div>

    <!-- Right Drawer -->
    <aside id="toolsDrawer"
           class="fixed right-0 top-0 h-full w-[24rem] max-w-[90vw] bg-white z-50 shadow-xl border-l border-gray-200
                  transform translate-x-full transition-transform">
      <!-- Header -->
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50">
        <div class="font-semibold text-gray-800">Quiddler Tools</div>
        <button id="toolsCloseBtn" class="text-gray-500 hover:text-gray-700 text-xl leading-none">âœ•</button>
      </div>

      <!-- Tabs -->
      <div class="px-4 pt-3">
        <div class="inline-flex text-sm rounded-lg overflow-hidden border border-gray-200">
          <button id="toolsTabDict" class="px-3 py-2 bg-white text-gray-900">Dictionary</button>
          <button id="toolsTabPlay" class="px-3 py-2 bg-gray-100 text-gray-600">Solver</button>
        </div>
      </div>

      <!-- Panels -->
      <div class="p-4 flex flex-col gap-4 overflow-y-auto h-[calc(100%-4.5rem-3rem)]">
        <!-- Dictionary panel -->
        <section id="toolsPanelDict">

          <div id="dictEmpty" class="mb-3 text-sm text-gray-500">Enter a word and press <kbd class="px-1 py-0.5 bg-gray-200 rounded">Enter</kbd> or click <em>Look up</em>.</div>
          <div class="flex items-center gap-2 mb-3">
            <input id="dictInput" type="text" placeholder="Type a wordâ€¦" class="flex-1 border rounded-lg px-3 py-2 outline-none focus:ring focus:ring-blue-200"/>
            <button id="dictGo" class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700">Look up</button>
          </div>

          <!-- Dictionary content -->
          <div id="dictContent" class="space-y-3">
            <!-- Local definition -->
            <div id="dictLocalWrap" class="hidden">
              <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Collins â€™19</div>
              <div id="dictLocal" class="text-sm text-gray-800"></div>
            </div>
            <!-- Online definition -->
            <div id="dictOnlineWrap" class="hidden">
              <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Online Dictionary</div>
              <div id="dictOnline" class="text-sm text-gray-800"></div>
            </div>
            <!-- Loading -->
            <div id="dictOnlineLoading" class="hidden text-xs text-gray-500">Looking upâ€¦</div>
          </div>

        </section>

        <!-- Play Helper panel -->
        <section id="toolsPanelPlay" class="hidden">
          <!-- Tiles -->
          <div id="tilesEmpty" class="mb-3 text-sm text-gray-500">
            Enter your hand, using parentheses around digraphs:
          </div>

          <!-- Tiles input -->
          <div>
            <input id="tilesInput" type="text" placeholder="e.g. (qu)i ck(er)"
                   class="w-full border rounded-lg px-3 py-2 outline-none focus:ring focus:ring-blue-200"/>
          </div>

          <!-- New: "Do not discard a card" -->
          <div class="mt-3">
            <label class="inline-flex items-center gap-2">
              <input id="optNoDiscard" type="checkbox" class="rounded">
              <span class="text-sm">Do not discard any card</span>
            </label>
          </div>

          <!-- Common/Zipf controls -->
          <div class="mt-4 mb-2 space-y-2">
            <label class="flex flex-wrap items-center gap-2">
              <input id="optCommonOnly" type="checkbox" class="rounded">
              <span class="text-sm">
                Consider only words with a
                <a href="https://en.wikipedia.org/wiki/Zipf%27s_law" target="_blank" rel="noopener noreferrer"
                   class="text-blue-600 hover:underline">Zipf</a>
                score of:
                <span id="zipfVal" class="font-semibold">2.0</span>
              </span>
            </label>
            <input id="optZipf" type="range" min="0" max="5" step="0.1" value="2.0"
                   class="w-full accent-blue-600">
            <label class="inline-flex items-center gap-2">
              <input id="optCommonOverride" type="checkbox" class="rounded">
              <span class="text-sm">Except include all 2 and 3 letter words</span>
            </label>
          </div>

          <!-- Current Longest / Current Most -->
          <div id="currentBonuses" class="grid grid-cols-2 gap-3 hidden">
            <div>
              <label for="optCurrentLongest" class="block text-sm font-medium text-gray-700 mb-1">Longest word to beat</label>
              <input id="optCurrentLongest" type="number" min="0" step="1" value="0"
                     class="w-full border rounded-lg px-3 py-2 text-right outline-none focus:ring focus:ring-blue-200"/>
            </div>
            <div>
              <label for="optCurrentMost" class="block text-sm font-medium text-gray-700 mb-1">Most words to beat</label>
              <input id="optCurrentMost" type="number" min="0" step="1" value="0"
                     class="w-full border rounded-lg px-3 py-2 text-right outline-none focus:ring focus:ring-blue-200"/>
            </div>
          </div>

          <!-- Action + Status -->
          <div class="mt-3 pt-2 flex items-center gap-2">
            <button id="playGo" class="bg-blue-500 text-white px-3 py-2 rounded-lg">
              Solve
            </button>
            <span id="playStatus" class="text-sm text-gray-500"></span>
          </div>

          <!-- Results -->
          <div id="playResult" class="mt-2 hidden"></div>

        </section>
      </div>
    </aside>

    <!-- Core data and helpers -->
    <script src="collins_dictionary.js"></script>
    <script src="card_scores.js"></script>
    <script src="common_lemmas.js"></script>

    <!-- Wink lemmatizer (ESM) -->
    <script type="module">
      import lemmatizer from "https://cdn.jsdelivr.net/npm/wink-lemmatizer/+esm";
      window.winkLemmatizer = lemmatizer;
    </script>

    <!-- Split app scripts -->
    <script src="dictionary_api.js"></script>
    <script src="scoring.js"></script>
    <script src="render.js"></script>
    <script src="optimizer.js"></script>
    <script src="game.js"></script>
    <script src="tools_drawer.js"></script>

    <!-- Bootstrap -->
    <script>
      // Initialize the tools drawer and button tooltips
      window.QuiddlerTools?.init ? window.QuiddlerTools.init() : initToolsDrawer();

      // Wire buttons to namespaced APIs (fallback to globals during migration)
      document.getElementById('gameGo')?.addEventListener('click', () => {
        (window.QuiddlerGame?.startGame || window.startGame)?.();
      });
      document.getElementById('submitRoundBtn')?.addEventListener('click', () => {
        (window.QuiddlerGame?.nextRound || window.nextRound)?.();
      });
    </script>
</body>
</html>
